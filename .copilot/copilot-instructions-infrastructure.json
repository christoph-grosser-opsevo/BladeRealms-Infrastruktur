{
  "project": {
    "name": "BladeRealms Infrastructure",
    "description": "Azure Infrastructure as Code für BladeRealms mit Bicep",
    "type": "Infrastructure (Bicep + PowerShell)",
    "repository": "bladerealms-infrastructure"
  },
  
  "tech_stack": {
    "iac": "Bicep (exklusiv)",
    "scripting": "PowerShell 7+ mit Az-Module",
    "cloud": "Azure (exklusiv)",
    "ci_cd": "GitHub Actions",
    "version_control": "Git/GitHub",
    "azure_interaction": "Az PowerShell Module (KEINE Azure CLI)"
  },
  
  "architecture": {
    "strategy": "Unified Infrastructure (Dev = Prod)",
    "resource_groups": ["rg-bladerealms-dev", "rg-bladerealms-prod", "rg-bladerealms-shared"],
    "resources": {
      "container_registry": "GitHub Container Registry (ghcr.io) - External",
      "compute": ["Azure Container Instances (Dev)", "Azure Container Apps (Prod)"],
      "networking": "Azure Application Gateway",
      "security": "Azure Key Vault (inkl. GitHub Registry Credentials)",
      "storage": "Azure Storage Account",
      "monitoring": ["Application Insights", "Log Analytics Workspace"]
    }
  },
  
  "coding_principles": {
    "iac_best_practices": [
      "Minimalismus: Nur notwendige Ressourcen, keine Over-Engineering",
      "Effizienter Code: Kurz, präzise, wartbar",
      "Bicep exklusiv - keine ARM-Templates, kein Terraform",
      "Modulare Bicep-Struktur (wiederverwendbare Module)",
      "Parameter-Files für Umgebungen (dev.parameters.json, prod.parameters.json)",
      "Identische Infrastruktur Dev/Prod (nur Parameter unterschiedlich)",
      "Bicep Linting & Validation vor jedem Deployment",
      "What-If-Prüfung vor Production-Deployments"
    ],
    "powershell_best_practices": [
      "PowerShell 7+ für alle Scripts",
      "Cmdlet-Binding für alle Scripts",
      "Error-Handling mit Try-Catch",
      "Verbose-Output für Debugging",
      "Parameter-Validation",
      "Azure PowerShell Module (Az.*) verwenden"
    ],
    "security": [
      "Secrets in Azure Key Vault (nie in Code oder Git)",
      "KeyVault-Referenzen in .bicepparam Files verwenden (getSecret(), nicht Plaintext)",
      "Managed Identities für Service-to-Service Auth",
      "RBAC für Resource Groups",
      "Key Vault Access Policies oder RBAC für Container Identities",
      "Network Security Groups für Container",
      "SSL/TLS für alle externen Verbindungen"
    ],
    "cost_optimization": [
      "Container Instances für Dev (Low-Spec)",
      "Auto-Shutdown für Dev außerhalb Arbeitszeiten",
      "Azure Pay-as-you-go für Prod (nur bei Bedarf)",
      "Monitoring-Alerts für Budget-Überschreitungen"
    ]
  },
  
  "bicep_structure": {
    "overview": "Hierarchische Struktur: deployment → infrastructure → resource → modules",
    "layers": {
      "deployment": {
        "path": "deployment/*.ps1",
        "description": "PowerShell-Scripts für Deployment-Orchestrierung",
        "responsibility": "Liest .bicepparam Files und orchestriert Deployments"
      },
      "infrastructure": {
        "path": "infrastructure/rg-*/[resource].bicepparam",
        "description": "Bicep-Parameter-Files pro Resource Group",
        "responsibility": "Umgebungs-spezifische Parameter (using '../../resource/...')",
        "structure": [
          "infrastructure/rg-bladerealms-dev-weu-001/*.bicepparam",
          "infrastructure/rg-bladerealms-prod-weu-001/*.bicepparam",
          "infrastructure/rg-bladerealms-shared-weu-001/*.bicepparam"
        ]
      },
      "resource": {
        "path": "resource/[type]/[resource].bicep",
        "description": "Bicep-Templates für konkrete Ressourcen",
        "responsibility": "Definiert einzelne Azure-Ressourcen (module '../../modules/...')",
        "types": [
          "resource/container-instance/",
          "resource/container-app/",
          "resource/application-gateway/",
          "resource/key-vault/",
          "resource/monitoring/"
        ],
        "note": "Keine Azure Container Registry - verwendet GitHub Container Registry (ghcr.io)"
      },
      "modules": {
        "path": "modules/[type]/[module].bicep",
        "description": "Wiederverwendbare Bicep-Module",
        "responsibility": "Abstrakte, wiederverwendbare Komponenten",
        "types": [
          "modules/networking/",
          "modules/compute/",
          "modules/security/",
          "modules/monitoring/"
        ]
      }
    },
    "flow": [
      "1. deployment/*.ps1 (Orchestrierung)",
      "2. infrastructure/rg-*/[resource].bicepparam (Parameter)",
      "3. resource/[type]/[resource].bicep (Ressourcen-Definition)",
      "4. modules/[type]/[module].bicep (Wiederverwendbare Module)",
      "5. Azure Resource Manager (Deployment)"
    ],
    "naming_convention": {
      "standard": "Microsoft Azure Cloud Adoption Framework",
      "pattern": "<resource-type>-<workload>-<environment>-<region>-<instance>",
      "delimiter": "-",
      "resource_abbreviations": {
        "resource_group": "rg",
        "container_registry": "cr",
        "container_instance": "ci",
        "container_app": "ca",
        "container_app_environment": "cae",
        "key_vault": "kv",
        "storage_account": "st",
        "application_insights": "appi",
        "log_analytics_workspace": "log",
        "application_gateway": "agw",
        "network_security_group": "nsg",
        "virtual_network": "vnet",
        "subnet": "snet",
        "managed_identity": "id"
      },
      "examples": {
        "resource_group": "rg-bladerealms-prod-weu-001",
        "container_registry": "crbladerealms",
        "container_instance": "ci-bladerealms-server-dev-weu-001",
        "container_app": "ca-bladerealms-server-prod-weu-001",
        "key_vault": "kv-bladerealms-shared-weu",
        "storage_account": "stbladereamsprodweu",
        "application_insights": "appi-bladerealms-prod-weu",
        "log_analytics_workspace": "log-bladerealms-prod-weu"
      },
      "rules": [
        "Keine Großbuchstaben (Azure-Konvention)",
        "Hyphen als Delimiter (außer bei Storage Accounts)",
        "Region-Codes: westeurope=weu, northeurope=neu, eastus2=eus2",
        "Instanz-Nummer: 001, 002, 003 (3-stellig)",
        "Workload-Name: bladerealms (konsistent über alle Ressourcen)",
        "Environment: dev, prod, shared"
      ]
    }
  },
  
  "deployment_workflow": {
    "dev": [
      "1. Validate Bicep Template",
      "2. Run What-If Analysis",
      "3. Deploy to rg-bladerealms-dev",
      "4. Verify Deployment",
      "5. Run Smoke Tests"
    ],
    "prod": [
      "1. Validate Bicep Template",
      "2. Run What-If Analysis (MANDATORY)",
      "3. Manual Approval",
      "4. Deploy to rg-bladerealms-prod",
      "5. Health Check",
      "6. Rollback-Plan ready"
    ]
  },
  
  "best_practices": {
    "bicep": [
      "Minimalistischer Code-Style: So wenig Code wie möglich, so viel wie nötig",
      "Keine redundanten Variablen oder überflüssigen Abstraktionen",
      "DRY-Prinzip: Module nur bei wirklicher Wiederverwendung",
      "4-Layer-Struktur: deployment → infrastructure → resource → modules",
      ".bicepparam Files für Parameter (nicht .json)",
      "using-Statement in .bicepparam für Resource-Referenz",
      "module-Statement in resource/*.bicep für Module-Referenz",
      "Relative Pfade: '../../resource/...' und '../../modules/...'",
      "KeyVault-Referenzen in .bicepparam mit getSecret() für Secrets",
      "@secure() Decorator für alle Secret-Parameter in .bicep Files",
      "Output-Variables nur wenn tatsächlich benötigt",
      "Parameter mit @description (kurz und präzise)",
      "Tagging für alle Ressourcen (Environment, Project, ManagedBy)",
      "Microsoft Azure Naming Standards verwenden",
      "Resource-Abbreviations gemäß CAF (Cloud Adoption Framework)"
    ],
    "powershell": [
      "CmdletBinding() für alle Scripts",
      "[Parameter(Mandatory=$true)] für Required-Parameter",
      "$ErrorActionPreference = 'Stop' für Fail-Fast",
      "Write-Host für User-Output, Write-Verbose für Debug",
      "Try-Catch-Finally für Error-Handling",
      "Az-Cmdlets statt Azure CLI wo möglich"
    ],
    "azure": [
      "Resource Locks für Production-Ressourcen",
      "Diagnostic Settings für alle Ressourcen",
      "Activity Logs in Log Analytics",
      "Budget Alerts konfigurieren",
      "Backup-Strategy für kritische Daten"
    ]
  },
  
  "avoid": [
    "Over-Engineering: Keine unnötigen Abstraktionen oder Module",
    "Redundanter Code: Keine wiederholten Variablen-Definitionen",
    "Überflüssige Outputs: Nur exportieren was wirklich gebraucht wird",
    "Azure CLI verwenden (stattdessen Az PowerShell Module)",
    "ARM-Templates oder Terraform verwenden",
    "Unterschiedliche Infrastruktur zwischen Dev und Prod",
    "Secrets in Bicep-Files oder Git committen",
    "Manuelle Änderungen in Azure Portal (nur via IaC)",
    "Prod-Deployments ohne What-If-Prüfung",
    "Fehlende Resource-Tags",
    "Hardcoded Values in Bicep (stattdessen Parameter)",
    "bash/sh Scripts (Windows-Umgebung mit PowerShell)"
  ],
  
  "monitoring": {
    "application_insights": [
      "Custom Metrics für Server-Performance",
      "Telemetry für Player-Count, PvP-Stats",
      "Availability Tests für Server-Endpoints"
    ],
    "log_analytics": [
      "Container Logs zentral sammeln",
      "Kusto Queries für Fehleranalyse",
      "Dashboards für Ops-Team"
    ],
    "alerts": [
      "Container Restart-Alerts",
      "High CPU/Memory Usage",
      "Budget-Überschreitung Warnings"
    ]
  },
  
  "documentation": {
    "readme": "Setup, Prerequisites, Deployment-Schritte",
    "bicep_modules": "Kommentare für alle Parameter und Outputs",
    "powershell_scripts": "Get-Help kompatible Kommentare",
    "runbooks": "Step-by-Step für häufige Operationen"
  }
}
